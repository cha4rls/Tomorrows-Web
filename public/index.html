<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Portfolio</title>
    <link rel="stylesheet" href="styles.css">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
</head>
<body>
    <!-- Navigation -->
    <nav>
        <div class="nav-container">
            <!-- Admin Toggle -->
            <button class="admin-toggle" onclick="toggleAdmin()">‚öôÔ∏è</button>
            
            <ul>
                <li><a href="#home" onclick="scrollToSection('home')">Home</a></li>
                <li><a href="#about" onclick="scrollToSection('about')">About</a></li>
                <li><a href="#gallery" onclick="scrollToSection('gallery')">Gallery</a></li>
                <li><a href="#testimonials" onclick="scrollToSection('testimonials')">Testimonials</a></li>
                <li><a href="#contact" onclick="scrollToSection('contact')">Contact</a></li>
            </ul>
            
            <!-- Theme Toggle -->
            <button class="theme-toggle" onclick="toggleTheme()">üåô</button>
        </div>
    </nav>

    <!-- Admin Panel -->
    <div class="admin-panel" id="adminPanel">
        <h2>Admin Panel</h2>
        
        <!-- Firebase Authentication Status -->
        <div class="admin-section">
            <h3>Authentication Status</h3>
            <div id="authStatus">Not logged in</div>
            <div id="firebaseAuth" style="display: none;">
                <div class="form-group">
                    <label>Admin Email:</label>
                    <input type="email" id="firebaseEmail" placeholder="your-admin@email.com">
                </div>
                <div class="form-group">
                    <label>Admin Password:</label>
                    <input type="password" id="firebasePassword" placeholder="Your secure password">
                </div>
                <button class="btn" onclick="firebaseLogin()">Login with Firebase</button>
                <button class="btn btn-secondary" onclick="firebaseLogout()">Logout</button>
            </div>
        </div>
        
        <div class="admin-section">
            <h3>Profile Settings</h3>
            <div class="form-group">
                <label>Name:</label>
                <input type="text" id="adminName" placeholder="Your Name">
            </div>
            <div class="form-group">
                <label>Bio:</label>
                <textarea id="adminBio" rows="4" placeholder="Your bio..."></textarea>
            </div>
            <div class="form-group">
                <label>Profile Picture URL:</label>
                <input type="url" id="adminProfilePic" placeholder="https://...">
            </div>
            <button class="btn" onclick="updateProfile()">Update Profile</button>
        </div>

        <div class="admin-section">
            <h3>Social Links</h3>
            <div class="form-group">
                <label>LinkedIn:</label>
                <input type="url" id="adminLinkedIn" placeholder="https://www.linkedin.com/in/reyes-charls/">
            </div>
            <div class="form-group">
                <label>Facebook:</label>
                <input type="url" id="adminFacebook" placeholder="https://www.facebook.com/quoisv/">
            </div>
            <div class="form-group">
                <label>Instagram:</label>
                <input type="url" id="adminInstagram" placeholder="https://www.instagram.com/quoisv/">
            </div>
            <div class="form-group">
                <label>Spotify:</label>
                <input type="url" id="adminSpotify" placeholder="https://open.spotify.com/user/zsjyvy9ok333j06gueov5e25v">
            </div>
            <button class="btn" onclick="updateSocialLinks()">Update Links</button>
        </div>

        <div class="admin-section">
            <h3>Gallery Management</h3>
            <div class="form-group">
                <label>Add Image URL:</label>
                <input type="url" id="newGalleryImage" placeholder="https://...">
            </div>
            <div class="form-group">
                <label>Image Title:</label>
                <input type="text" id="newGalleryTitle" placeholder="Image title...">
            </div>
            <button class="btn" onclick="addGalleryImage()">Add Image</button>
            <button class="btn btn-secondary" onclick="toggleGalleryEdit()">Edit Mode</button>
        </div>

        <div class="admin-section">
            <h3>Testimonial Management</h3>
            <button class="btn" onclick="loadPendingTestimonials()">View Pending Testimonials</button>
            <div id="pendingTestimonials" style="margin-top: 15px;"></div>
        </div>
    </div>

    <!-- Hero Section -->
    <section id="home" class="hero">
        <div class="hero-content">
            <img src="https://i.imgur.com/qsDslHa.png" alt="Profile Picture" class="profile-pic" id="profilePic" onclick="changeProfilePic()">
            <h1 id="heroName">Your Name</h1>
            <p id="heroBio">Web Developer & Creative Professional</p>
        </div>
    </section>

    <!-- About Section -->
    <section id="about" class="section">
        <div class="container">
            <h2>About Me</h2>
            <div class="about-content">
                <div>
                    <h3>Education & Background</h3>
                    <p><strong>‚Ä¢Year 3 Creative Computing Student @ Bath Spa University RAK</strong><br>
                        ‚Ä¢Currently pursuing my degree with focus on web development.</p>
                    
                    <h3 style="margin-top: 30px;">Interests</h3>
                    <ul style="list-style: none; padding: 0;">
                        <li>üåê Web Development</li>
                        <li>üèÄ Basketball</li>
                        <li>üéµ Music</li>
                        <li>üèéÔ∏è Cars</li>
                        <li>üéÆ Video Games</li>
                    </ul>
                </div>
                <div>
                    <p class="about-text" id="aboutText">
                        I'm a passionate web developer with a keen eye for design and a love for creating innovative digital experiences. My journey in technology started with curiosity and has evolved into a career focused on building meaningful applications that solve real-world problems.
                    </p>
                    <div class="skills">
                        <span class="skill-tag">HTML5</span>
                        <span class="skill-tag">CSS3</span>
                        <span class="skill-tag">JavaScript</span>
                        <span class="skill-tag">Firebase</span>
                        <span class="skill-tag">Android Studio</span>
                        <span class="skill-tag">Python</span>
                        <span class="skill-tag">Git</span>
                        <span class="skill-tag">Responsive Design</span>
                    </div>
                </div>
            </div>
            
            <!-- Social Links -->
            <div class="demo-container">
                <h2>Connect with me!</h2>
                <div class="social-links" id="socialLinks">
                    <!-- Social links will be loaded from Firestore -->
                </div>
            </div>
        </div>
    </section>

    <!-- Gallery Section -->
    <section id="gallery" class="section">
        <div class="container">
            <h2>My Work</h2>
            <div class="gallery-grid" id="gallery">
                <!-- Gallery will be loaded from Firestore -->
            </div>
        </div>
    </section>

    <!-- Testimonials Section -->
    <section id="testimonials" class="section">
        <div class="container">
            <h2>What People Say</h2>
            <div class="testimonials-grid" id="testimonialsGrid">
                <!-- Testimonials will be loaded here -->
            </div>
            
            <div class="testimonial-form">
                <h3>Leave a Testimonial</h3>
                <form onsubmit="submitTestimonial(event)">
                    <div class="form-group">
                        <label for="testimonialName">Your Name:</label>
                        <input type="text" id="testimonialName" required>
                    </div>
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="anonymous">
                            <label for="anonymous">Post anonymously</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="testimonialRole">Your Role/Relationship:</label>
                        <select id="testimonialRole">
                            <option value="Friend">Friend</option>
                            <option value="Classmate">Classmate</option>
                            <option value="Colleague">Colleague</option>
                            <option value="Client">Client</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="testimonialRating">Rating:</label>
                        <select id="testimonialRating">
                            <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (5 stars)</option>
                            <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê (4 stars)</option>
                            <option value="3">‚≠ê‚≠ê‚≠ê (3 stars)</option>
                            <option value="2">‚≠ê‚≠ê (2 stars)</option>
                            <option value="1">‚≠ê (1 star)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="testimonialMessage">Your Message:</label>
                        <textarea id="testimonialMessage" rows="4" required placeholder="Share your experience..."></textarea>
                    </div>
                    <button type="submit" class="btn">Submit Testimonial</button>
                </form>
                <div id="testimonialStatus" style="margin-top: 15px;"></div>
            </div>
        </div>
    </section>

    <!-- Contact Section -->
    <section id="contact" class="section">
        <div class="container">
            <h2>Get In Touch</h2>
            <div class="testimonial-form">
                <form onsubmit="submitContact(event)">
                    <div class="form-group">
                        <label for="contactName">Your Name:</label>
                        <input type="text" id="contactName" required>
                    </div>
                    <div class="form-group">
                        <label for="contactEmail">Your Email:</label>
                        <input type="email" id="contactEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="contactSubject">Subject:</label>
                        <input type="text" id="contactSubject" required>
                    </div>
                    <div class="form-group">
                        <label for="contactMessage">Message:</label>
                        <textarea id="contactMessage" rows="5" required placeholder="Your message..."></textarea>
                    </div>
                    <button type="submit" class="btn">Send Message</button>
                </form>
                <div id="contactStatus" style="margin-top: 15px;"></div>
            </div>
        </div>
    </section>

    <!-- Modal for Gallery -->
    <div class="modal" id="imageModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal()">√ó</button>
            <img id="modalImage" src="" alt="">
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCR0E6LE9DIwHPV5LQP-MhCn8LLCTIgSGA",
            authDomain: "my-awesome-portfolio-6eca1.firebaseapp.com",
            projectId: "my-awesome-portfolio-6eca1",
            storageBucket: "my-awesome-portfolio-6eca1.firebasestorage.app",
            messagingSenderId: "404489279066",
            appId: "1:404489279066:web:f8f244f491334fb9efea63",
            measurementId: "G-KELCE11P82"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        // Your admin UID
        const ADMIN_UID = "2cnh9Yzukve3IAUJdILvtAHEe9y1";

        // Global variables
        let isAdminMode = false;
        let isGalleryEditMode = false;
        let adminAuthenticated = false;
        let firebaseUser = null;
        
        // Real-time listeners
        let profileListener = null;
        let socialLinksListener = null;
        let galleryListener = null;
        let themeListener = null;
        
        // Initialize the website
        document.addEventListener('DOMContentLoaded', function() {
            setupFirebaseAuth();
            setupRealtimeListeners();
            setupScrollEffects();
            setupSmoothScrolling();
            loadThemeFromFirestore();
            loadTestimonialsFromFirebase();
        });

        // Setup real-time listeners for public data
        function setupRealtimeListeners() {
            // Profile listener (public data)
            profileListener = db.collection('public').doc('profile').onSnapshot((doc) => {
                if (doc.exists) {
                    updateProfileUI(doc.data());
                } else {
                    // Load default profile if no data exists
                    updateProfileUI({
                        name: 'Your Name',
                        bio: 'Web Developer & Creative Professional',
                        profilePic: 'https://i.imgur.com/qsDslHa.png'
                    });
                }
            }, (error) => {
                console.log('Profile listener error:', error);
                // Load defaults on error
                updateProfileUI({
                    name: 'Your Name',
                    bio: 'Web Developer & Creative Professional',
                    profilePic: 'https://i.imgur.com/qsDslHa.png'
                });
            });

            // Social links listener (public data)
            socialLinksListener = db.collection('public').doc('socialLinks').onSnapshot((doc) => {
                if (doc.exists) {
                    updateSocialLinksUI(doc.data());
                } else {
                    // Load default social links
                    updateSocialLinksUI({
                        linkedin: 'https://www.linkedin.com/in/reyes-charls/',
                        facebook: 'https://www.facebook.com/quoisv/',
                        instagram: 'https://www.instagram.com/quoisv/',
                        spotify: 'https://open.spotify.com/user/zsjyvy9ok333j06gueov5e25v'
                    });
                }
            }, (error) => {
                console.log('Social links listener error:', error);
                // Load defaults on error
                updateSocialLinksUI({
                    linkedin: 'https://www.linkedin.com/in/reyes-charls/',
                    facebook: 'https://www.facebook.com/quoisv/',
                    instagram: 'https://www.instagram.com/quoisv/',
                    spotify: 'https://open.spotify.com/user/zsjyvy9ok333j06gueov5e25v'
                });
            });

            // Gallery listener (public data) - Fixed version
            galleryListener = db.collection('public').doc('gallery').onSnapshot((doc) => {
                if (doc.exists && doc.data().images && doc.data().images.length > 0) {
                    console.log('Loading gallery from Firestore:', doc.data().images.length, 'images');
                    updateGalleryUI(doc.data().images);
                } else {
                    console.log('No gallery data in Firestore, loading defaults');
                    initializeDefaultGallery();
                }
            }, (error) => {
                console.log('Gallery listener error:', error);
                loadDefaultGallery();
            });

            // Theme listener (public data)
            themeListener = db.collection('public').doc('theme').onSnapshot((doc) => {
                if (doc.exists && doc.data().darkMode !== undefined) {
                    updateThemeUI(doc.data().darkMode);
                }
            }, (error) => {
                console.log('Theme listener error:', error);
            });
        }

        // UI Update Functions
        function updateProfileUI(profile) {
            const heroName = document.getElementById('heroName');
            const heroBio = document.getElementById('heroBio');
            const profilePic = document.getElementById('profilePic');
            
            if (heroName) heroName.textContent = profile.name || 'Your Name';
            if (heroBio) heroBio.textContent = profile.bio || 'Web Developer & Creative Professional';
            if (profilePic && profile.profilePic) {
                profilePic.src = profile.profilePic;
            }
        }

        function updateSocialLinksUI(socialLinks) {
            const socialLinksContainer = document.getElementById('socialLinks');
            if (!socialLinksContainer) return;
            
            const links = [
                { 
                    key: 'linkedin', 
                    icon: 'https://cdn-icons-png.flaticon.com/512/174/174857.png', 
                    title: 'LinkedIn' 
                },
                { 
                    key: 'facebook', 
                    icon: 'https://cdn-icons-png.flaticon.com/512/733/733547.png', 
                    title: 'Facebook' 
                },
                { 
                    key: 'instagram', 
                    icon: 'https://cdn-icons-png.flaticon.com/512/174/174855.png', 
                    title: 'Instagram' 
                },
                { 
                    key: 'spotify', 
                    icon: 'https://cdn-icons-png.flaticon.com/512/174/174872.png', 
                    title: 'Spotify' 
                }
            ];
            
            socialLinksContainer.innerHTML = '';
            
            links.forEach(link => {
                const a = document.createElement('a');
                a.className = 'social-link';
                a.setAttribute('data-tooltip', link.title);
                
                const img = document.createElement('img');
                img.src = link.icon;
                img.alt = link.title;
                a.appendChild(img);
                
                if (socialLinks[link.key] && socialLinks[link.key].trim() !== '') {
                    a.href = socialLinks[link.key];
                    a.target = '_blank';
                    a.onclick = null;
                } else {
                    a.href = '#';
                    a.onclick = (e) => {
                        e.preventDefault();
                        alert(`${link.title} link not set. Please configure in admin panel.`);
                    };
                }
                
                socialLinksContainer.appendChild(a);
            });
        }

        function updateGalleryUI(images) {
            const gallery = document.getElementById('gallery');
            if (!gallery) return;
            
            gallery.innerHTML = '';
            
            images.forEach((item, index) => {
                const galleryItem = document.createElement('div');
                galleryItem.className = 'gallery-item';
                galleryItem.onclick = () => openModal(galleryItem);
                
                const img = document.createElement('img');
                img.src = item.src;
                img.alt = item.alt || `Gallery Image ${index + 1}`;
                galleryItem.appendChild(img);
                
                if (isGalleryEditMode && adminAuthenticated) {
                    const deleteBtn = document.createElement('button');
                    deleteBtn.className = 'delete-btn';
                    deleteBtn.innerHTML = '√ó';
                    deleteBtn.onclick = (e) => {
                        e.stopPropagation();
                        deleteGalleryImage(index);
                    };
                    galleryItem.appendChild(deleteBtn);
                }
                
                gallery.appendChild(galleryItem);
            });
        }

        function updateThemeUI(isDarkMode) {
            if (isDarkMode) {
                document.body.classList.add('dark-mode');
                document.querySelector('.theme-toggle').innerHTML = '‚òÄÔ∏è';
            } else {
                document.body.classList.remove('dark-mode');
                document.querySelector('.theme-toggle').innerHTML = 'üåô';
            }
        }

        // Firebase Authentication Setup
        function setupFirebaseAuth() {
            auth.onAuthStateChanged((user) => {
                firebaseUser = user;
                updateAuthStatus();
                if (user && user.uid === ADMIN_UID) {
                    adminAuthenticated = true;
                    isAdminMode = true;
                    document.body.classList.add('admin-mode');
                } else {
                    adminAuthenticated = false;
                    isAdminMode = false;
                    document.body.classList.remove('admin-mode');
                    document.getElementById('adminPanel').classList.remove('open');
                }
            });
        }

        function updateAuthStatus() {
            const statusDiv = document.getElementById('authStatus');
            if (firebaseUser) {
                statusDiv.innerHTML = `‚úÖ Logged in as: ${firebaseUser.email}`;
                statusDiv.style.color = 'green';
            } else {
                statusDiv.innerHTML = '‚ùå Not logged in to Firebase';
                statusDiv.style.color = 'red';
            }
        }

        async function firebaseLogin() {
            const email = document.getElementById('firebaseEmail').value;
            const password = document.getElementById('firebasePassword').value;
            
            if (!email || !password) {
                alert('Please enter both email and password');
                return;
            }
            
            try {
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                if (userCredential.user.uid === ADMIN_UID) {
                    alert('Successfully logged in as admin!');
                    loadAdminData();
                } else {
                    alert('Access denied. You are not authorized as admin.');
                    await auth.signOut();
                }
            } catch (error) {
                alert('Login failed: ' + error.message);
            }
        }

        async function firebaseLogout() {
            try {
                await auth.signOut();
                alert('Successfully logged out');
            } catch (error) {
                alert('Logout failed: ' + error.message);
            }
        }

        // Admin Functions
        function toggleAdmin() {
            if (!adminAuthenticated) {
                document.getElementById('firebaseAuth').style.display = 'block';
                document.getElementById('adminPanel').classList.add('open');
            } else {
                document.getElementById('adminPanel').classList.toggle('open');
                if (document.getElementById('adminPanel').classList.contains('open')) {
                    loadAdminData();
                }
            }
        }

        async function loadAdminData() {
            try {
                // Load profile data for admin forms
                const profileDoc = await db.collection('public').doc('profile').get();
                if (profileDoc.exists) {
                    const profile = profileDoc.data();
                    document.getElementById('adminName').value = profile.name || '';
                    document.getElementById('adminBio').value = profile.bio || '';
                    document.getElementById('adminProfilePic').value = profile.profilePic || '';
                }

                // Load social links data for admin forms
                const socialDoc = await db.collection('public').doc('socialLinks').get();
                if (socialDoc.exists) {
                    const socialLinks = socialDoc.data();
                    document.getElementById('adminLinkedIn').value = socialLinks.linkedin || '';
                    document.getElementById('adminFacebook').value = socialLinks.facebook || '';
                    document.getElementById('adminInstagram').value = socialLinks.instagram || '';
                    document.getElementById('adminSpotify').value = socialLinks.spotify || '';
                }
            } catch (error) {
                console.error('Error loading admin data:', error);
            }
        }

        // Profile Management
        async function updateProfile() {
            if (!adminAuthenticated) {
                alert('Please login as admin first');
                return;
            }
            
            const profile = {
                name: document.getElementById('adminName').value || 'Your Name',
                bio: document.getElementById('adminBio').value || 'Web Developer & Creative Professional',
                profilePic: document.getElementById('adminProfilePic').value || 'https://i.imgur.com/qsDslHa.png',
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            try {
                await db.collection('public').doc('profile').set(profile);
                alert('Profile updated successfully!');
            } catch (error) {
                console.error('Error updating profile:', error);
                alert('Error updating profile: ' + error.message);
            }
        }

        async function changeProfilePic() {
            if (!adminAuthenticated) {
                alert('Please login as admin first');
                return;
            }
            
            const newUrl = prompt('Enter new profile picture URL:');
            if (newUrl && newUrl.trim() !== '') {
                try {
                    await db.collection('public').doc('profile').update({
                        profilePic: newUrl,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    const adminProfilePicField = document.getElementById('adminProfilePic');
                    if (adminProfilePicField) {
                        adminProfilePicField.value = newUrl;
                    }
                    
                    alert('Profile picture updated successfully!');
                } catch (error) {
                    console.error('Error updating profile picture:', error);
                    alert('Error updating profile picture: ' + error.message);
                }
            }
        }

        // Social Links Management
        async function updateSocialLinks() {
            if (!adminAuthenticated) {
                alert('Please login as admin first');
                return;
            }
            
            const socialLinks = {
                linkedin: document.getElementById('adminLinkedIn').value || '',
                facebook: document.getElementById('adminFacebook').value || '',
                instagram: document.getElementById('adminInstagram').value || '',
                spotify: document.getElementById('adminSpotify').value || '',
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            try {
                await db.collection('public').doc('socialLinks').set(socialLinks);
                alert('Social links updated successfully!');
            } catch (error) {
                console.error('Error updating social links:', error);
                alert('Error updating social links: ' + error.message);
            }
        }

        // Gallery Management
        async function addGalleryImage() {
            if (!adminAuthenticated) {
                alert('Please login as admin first');
                return;
            }

            const imageUrl = document.getElementById('newGalleryImage').value;
            const imageTitle = document.getElementById('newGalleryTitle').value;
            
            if (!imageUrl) {
                alert('Please enter an image URL');
                return;
            }
            
            try {
                // Get current gallery
                const doc = await db.collection('public').doc('gallery').get();
                let images = [];
                if (doc.exists && doc.data().images) {
                    images = doc.data().images;
                }
                
                // Add new image
                images.push({
                    src: imageUrl,
                    alt: imageTitle || 'Gallery Image',
                    addedAt: new Date().toISOString()
                });
                
                // Save to Firestore
                await db.collection('public').doc('gallery').set({
                    images: images,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                document.getElementById('newGalleryImage').value = '';
                document.getElementById('newGalleryTitle').value = '';
                alert('Image added successfully!');
            } catch (error) {
                console.error('Error adding gallery image:', error);
                alert('Error adding image: ' + error.message);
            }
        }

        async function deleteGalleryImage(index) {
            if (!adminAuthenticated) return;
            
            if (confirm('Are you sure you want to delete this image?')) {
                try {
                    const doc = await db.collection('public').doc('gallery').get();
                    if (doc.exists && doc.data().images) {
                        let images = doc.data().images;
                        images.splice(index, 1);
                        
                        await db.collection('public').doc('gallery').set({
                            images: images,
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        
                        alert('Image deleted successfully!');
                    }
                } catch (error) {
                    console.error('Error deleting gallery image:', error);
                    alert('Error deleting image: ' + error.message);
                }
            }
        }

        function toggleGalleryEdit() {
            if (!adminAuthenticated) {
                alert('Please login as admin first');
                return;
            }
            
            isGalleryEditMode = !isGalleryEditMode;
            
            // Re-render gallery with/without delete buttons
            db.collection('public').doc('gallery').get().then(doc => {
                if (doc.exists && doc.data().images) {
                    updateGalleryUI(doc.data().images);
                } else {
                    loadDefaultGallery();
                }
            }).catch(error => {
                console.error('Error loading gallery for edit mode:', error);
                loadDefaultGallery();
            });
            
            alert(isGalleryEditMode ? 'Gallery edit mode enabled - delete buttons now visible' : 'Gallery edit mode disabled');
        }

        function loadDefaultGallery() {
            const defaultImages = [
                { src: 'https://i.imgur.com/KlM35F0.jpeg', alt: 'Project 1' },
                { src: 'https://i.imgur.com/GnYduMU.jpeg', alt: 'Project 2' },
                { src: 'https://i.imgur.com/veyhBAu.jpeg', alt: 'Project 3' },
                { src: 'https://i.imgur.com/hI8VgnO.jpeg', alt: 'Project 4' },
                { src: 'https://i.imgur.com/JO8PjiK.jpeg', alt: 'Project 5' },
                { src: 'https://i.imgur.com/cH0hd4F.jpeg', alt: 'Project 6' }
            ];
            updateGalleryUI(defaultImages);
        }

        // Theme Management
        async function toggleTheme() {
            const isDarkMode = !document.body.classList.contains('dark-mode');
            
            try {
                await db.collection('public').doc('theme').set({
                    darkMode: isDarkMode,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
            } catch (error) {
                console.error('Error saving theme:', error);
                // Apply theme locally even if save fails
                updateThemeUI(isDarkMode);
            }
        }

        async function loadThemeFromFirestore() {
            try {
                const doc = await db.collection('public').doc('theme').get();
                if (doc.exists && doc.data().darkMode !== undefined) {
                    updateThemeUI(doc.data().darkMode);
                }
            } catch (error) {
                console.log('Error loading theme, using default');
            }
        }

        // Modal functionality
        function openModal(element) {
            const img = element.querySelector('img');
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');
            
            modalImg.src = img.src;
            modalImg.alt = img.alt;
            modal.classList.add('active');
        }

        function closeModal() {
            document.getElementById('imageModal').classList.remove('active');
        }

        // Testimonials with Firebase (unchanged)
        async function submitTestimonial(event) {
            event.preventDefault();
            
            const name = document.getElementById('testimonialName').value;
            const isAnonymous = document.getElementById('anonymous').checked;
            const role = document.getElementById('testimonialRole').value;
            const rating = document.getElementById('testimonialRating').value;
            const message = document.getElementById('testimonialMessage').value;
            
            const testimonial = {
                name: isAnonymous ? 'Anonymous' : name,
                role: role,
                rating: rating,
                message: message,
                approved: false,
                timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                date: new Date().toLocaleDateString()
            };
            
            const statusDiv = document.getElementById('testimonialStatus');
            statusDiv.innerHTML = '<div style="color: blue;">Submitting testimonial...</div>';
            
            try {
                await db.collection('testimonials').add(testimonial);
                statusDiv.innerHTML = '<div style="color: green;">‚úÖ Thank you! Your testimonial has been submitted and will appear after admin approval.</div>';
                event.target.reset();
            } catch (error) {
                console.error('Error submitting testimonial:', error);
                statusDiv.innerHTML = '<div style="color: red;">‚ùå Error submitting testimonial. Please try again.</div>';
            }
        }

        async function loadTestimonialsFromFirebase() {
            try {
                const snapshot = await db.collection('testimonials')
                    .where('approved', '==', true)
                    .orderBy('timestamp', 'desc')
                    .get();

                const grid = document.getElementById('testimonialsGrid');
                grid.innerHTML = '';
                
                if (snapshot.empty) {
                    loadDefaultTestimonials();
                    return;
                }

                snapshot.forEach(doc => {
                    const testimonial = doc.data();
                    const testimonialDiv = document.createElement('div');
                    testimonialDiv.className = 'testimonial';
                    
                    const stars = '‚≠ê'.repeat(parseInt(testimonial.rating));
                    
                    testimonialDiv.innerHTML = `
                        <div class="testimonial-content">"${testimonial.message}"</div>
                        <div class="testimonial-author">${testimonial.name}</div>
                        <div class="testimonial-role">${testimonial.role} ‚Ä¢ ${stars}</div>
                        <div class="testimonial-date">${testimonial.date}</div>
                        ${adminAuthenticated ? `<button class="delete-btn" onclick="deleteFirebaseTestimonial('${doc.id}')">√ó</button>` : ''}
                    `;
                    
                    grid.appendChild(testimonialDiv);
                });
            } catch (error) {
                console.error('Error loading testimonials:', error);
                loadDefaultTestimonials();
            }
        }

        async function loadPendingTestimonials() {
            if (!adminAuthenticated) {
                alert('Please login as admin first');
                return;
            }
            
            try {
                const snapshot = await db.collection('testimonials')
                    .where('approved', '==', false)
                    .orderBy('timestamp', 'desc')
                    .get();

                const container = document.getElementById('pendingTestimonials');
                
                if (snapshot.empty) {
                    container.innerHTML = '<p style="color: #666;">No pending testimonials.</p>';
                    return;
                }

                container.innerHTML = '<h4>Pending Testimonials:</h4>';
                snapshot.forEach(doc => {
                    const testimonial = doc.data();
                    const testimonialDiv = document.createElement('div');
                    testimonialDiv.style.cssText = 'background: #f9f9f9; padding: 15px; margin: 10px 0; border-radius: 8px; border-left: 4px solid #orange;';
                    
                    const stars = '‚≠ê'.repeat(parseInt(testimonial.rating));
                    
                    testimonialDiv.innerHTML = `
                        <div><strong>"${testimonial.message}"</strong></div>
                        <div style="margin: 10px 0;">- ${testimonial.name} (${testimonial.role}) ‚Ä¢ ${stars}</div>
                        <div style="font-size: 0.9em; color: #666;">${testimonial.date}</div>
                        <div style="margin-top: 10px;">
                            <button class="btn" style="background: green; margin-right: 10px;" onclick="approveTestimonial('${doc.id}')">‚úÖ Approve</button>
                            <button class="btn" style="background: red;" onclick="rejectTestimonial('${doc.id}')">‚ùå Reject</button>
                        </div>
                    `;
                    
                    container.appendChild(testimonialDiv);
                });
            } catch (error) {
                console.error('Error loading pending testimonials:', error);
                document.getElementById('pendingTestimonials').innerHTML = '<p style="color: red;">Error loading pending testimonials.</p>';
            }
        }

        async function approveTestimonial(docId) {
            try {
                await db.collection('testimonials').doc(docId).update({
                    approved: true,
                    approvedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                loadPendingTestimonials();
                loadTestimonialsFromFirebase();
                alert('Testimonial approved!');
            } catch (error) {
                alert('Error approving testimonial: ' + error.message);
            }
        }

        async function rejectTestimonial(docId) {
            if (confirm('Are you sure you want to reject this testimonial?')) {
                try {
                    await db.collection('testimonials').doc(docId).delete();
                    loadPendingTestimonials();
                    alert('Testimonial rejected and deleted.');
                } catch (error) {
                    alert('Error rejecting testimonial: ' + error.message);
                }
            }
        }

        async function deleteFirebaseTestimonial(docId) {
            if (!adminAuthenticated) return;
            
            if (confirm('Are you sure you want to delete this testimonial?')) {
                try {
                    await db.collection('testimonials').doc(docId).delete();
                    loadTestimonialsFromFirebase();
                    alert('Testimonial deleted.');
                } catch (error) {
                    alert('Error deleting testimonial: ' + error.message);
                }
            }
        }

        function loadDefaultTestimonials() {
            const testimonials = [
                {
                    id: 1,
                    name: "Sarah Johnson",
                    role: "Classmate",
                    rating: "5",
                    message: "Amazing work ethic and incredible attention to detail. Always delivers high-quality projects on time!",
                    date: new Date().toLocaleDateString()
                },
                {
                    id: 2,
                    name: "Mike Chen",
                    role: "Friend",
                    rating: "5",
                    message: "Creative problem solver with excellent communication skills. A pleasure to work with!",
                    date: new Date().toLocaleDateString()
                },
                {
                    id: 3,
                    name: "Anonymous",
                    role: "Colleague",
                    rating: "4",
                    message: "Highly skilled developer with a passion for innovation. Brings fresh ideas to every project.",
                    date: new Date().toLocaleDateString()
                }
            ];
            
            const grid = document.getElementById('testimonialsGrid');
            grid.innerHTML = '';
            
            testimonials.forEach(testimonial => {
                const testimonialDiv = document.createElement('div');
                testimonialDiv.className = 'testimonial';
                
                const stars = '‚≠ê'.repeat(parseInt(testimonial.rating));
                
                testimonialDiv.innerHTML = `
                    <div class="testimonial-content">"${testimonial.message}"</div>
                    <div class="testimonial-author">${testimonial.name}</div>
                    <div class="testimonial-role">${testimonial.role} ‚Ä¢ ${stars}</div>
                    <div class="testimonial-date">${testimonial.date}</div>
                `;
                
                grid.appendChild(testimonialDiv);
            });
        }

        // Contact form with Firebase (unchanged)
        async function submitContact(event) {
            event.preventDefault();
            
            const name = document.getElementById('contactName').value;
            const email = document.getElementById('contactEmail').value;
            const subject = document.getElementById('contactSubject').value;
            const message = document.getElementById('contactMessage').value;
            
            const contactData = {
                name: name,
                email: email,
                subject: subject,
                message: message,
                timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                read: false,
                date: new Date().toLocaleDateString()
            };
            
            const statusDiv = document.getElementById('contactStatus');
            statusDiv.innerHTML = '<div style="color: blue;">Sending message...</div>';
            
            try {
                await db.collection('contacts').add(contactData);
                statusDiv.innerHTML = '<div style="color: green;">‚úÖ Thank you! Your message has been sent successfully. I\'ll get back to you soon.</div>';
                event.target.reset();
            } catch (error) {
                console.error('Error sending message:', error);
                statusDiv.innerHTML = '<div style="color: red;">‚ùå Error sending message. Please try again.</div>';
            }
        }

        // Navigation and UI functions
        function scrollToSection(sectionId) {
            const section = document.getElementById(sectionId);
            const navHeight = 70;
            const targetPosition = section.offsetTop - navHeight;
            
            window.scrollTo({
                top: targetPosition,
                behavior: 'smooth'
            });
        }

        function setupSmoothScrolling() {
            window.addEventListener('scroll', () => {
                const sections = ['home', 'about', 'gallery', 'testimonials', 'contact'];
                const navHeight = 70;
                
                sections.forEach(sectionId => {
                    const section = document.getElementById(sectionId);
                    const rect = section.getBoundingClientRect();
                    const link = document.querySelector(`nav a[href="#${sectionId}"]`);
                    
                    if (rect.top <= navHeight && rect.bottom >= navHeight) {
                        document.querySelectorAll('nav a').forEach(a => a.classList.remove('active'));
                        link.classList.add('active');
                    }
                });
            });
        }

        function setupScrollEffects() {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                    }
                });
            }, {
                threshold: 0.1,
                rootMargin: '50px'
            });
            
            document.querySelectorAll('.section').forEach(section => {
                observer.observe(section);
            });
        }

        // Event listeners for modals and panel
        document.getElementById('imageModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        document.addEventListener('click', function(e) {
            const adminPanel = document.getElementById('adminPanel');
            const adminToggle = document.querySelector('.admin-toggle');
            
            if (!adminPanel.contains(e.target) && !adminToggle.contains(e.target)) {
                adminPanel.classList.remove('open');
            }
        });

        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeModal();
                document.getElementById('adminPanel').classList.remove('open');
            }
        });

        // Interactive skill tags
        document.querySelectorAll('.skill-tag').forEach(tag => {
            tag.addEventListener('click', () => {
                tag.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    tag.style.transform = '';
                }, 150);
            });
        });

        // Cleanup listeners on page unload
        window.addEventListener('beforeunload', () => {
            if (profileListener) profileListener();
            if (socialLinksListener) socialLinksListener();
            if (galleryListener) galleryListener();
            if (themeListener) themeListener();
        });
    </script>

    <style>
        /* Additional styles for Firebase integration */
        .admin-section {
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .btn {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
        }
        
        .btn:hover {
            background: #0056b3;
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .btn-secondary:hover {
            background: #545b62;
        }
        
        #authStatus {
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
            font-weight: bold;
        }
        
        .delete-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: red;
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
            font-size: 14px;
            display: none;
        }
        
        .testimonial {
            position: relative;
        }
        
        .admin-mode .delete-btn {
            display: block;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: auto;
        }

        /* Dark mode compatibility for social links */
        body.dark-mode .social-link {
            background: #555;
        }

        body.dark-mode .social-link:hover {
            background: #777;
        }

        /* Dark mode styles for admin panel */
        body.dark-mode .admin-panel {
            background: #2d2d2d;
        }

        body.dark-mode .admin-panel h2 {
            color: #ffffff;
        }

        body.dark-mode .admin-panel p {
            color: #e0e0e0;
        }

        body.dark-mode .admin-section {
            background: #3d3d3d;
            border-left-color: #007bff;
            border-bottom-color: #555;
        }

        body.dark-mode .admin-section h3 {
            color: #ffffff;
        }

        body.dark-mode .admin-panel .form-group label {
            color: #e0e0e0;
        }

        body.dark-mode .admin-panel .form-group input,
        body.dark-mode .admin-panel .form-group textarea,
        body.dark-mode .admin-panel .form-group select {
            background: #4d4d4d;
            border-color: #666;
            color: #ffffff;
        }

        /* Enhanced Gallery Grid Styles */
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
            padding: 0;
        }

        .gallery-item {
            position: relative;
            aspect-ratio: 4/3;
            border-radius: 10px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.4s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            background: #f0f0f0;
        }

        .gallery-item:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            z-index: 10;
        }

        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: all 0.4s ease;
            display: block;
        }

        .gallery-item:hover img {
            transform: scale(1.1);
        }

        /* Responsive gallery */
        @media (max-width: 768px) {
            .gallery-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .gallery-item {
                min-height: 250px;
            }
        }

        @media (min-width: 769px) and (max-width: 1024px) {
            .gallery-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (min-width: 1025px) {
            .gallery-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        /* Loading state for gallery images */
        .gallery-item img[src*="placeholder"] {
            filter: grayscale(100%);
            opacity: 0.7;
        }
    </style>
</body>
</html>